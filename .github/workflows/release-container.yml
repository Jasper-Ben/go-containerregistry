name: container-build

on:
  push:
    tags: ['*']

env:
  KO_DEFAULTPLATFORMS: all

jobs:
  golang:
    name: Build the crane container image
    runs-on: ubuntu-latest
    steps:
      - name: Check out the repo
        uses: actions/checkout@v4
      - name: Setup Go
        uses: actions/setup-go@v5
        with:
          go-version: 1.21
          check-latest: true
      - name: Setup Ko
        uses: ko-build/setup-ko@v0.7
      - name: Build the crane-ish builder images
        run: ko publish --bare -t latest -t ${{ env.GITHUB_SHA }} -t ${{ env.GITHUB_REF }}
        env:
          KO_CONFIG_PATH: ./.ko/default/.ko.yaml
      - name: Build the crane-ish builder debug images
        run: ko publish --bare -t latest -t ${{ env.GITHUB_SHA }} -t ${{ env.GITHUB_REF }}
        env:
          KO_CONFIG_PATH: ./.ko/debug/.ko.yaml
